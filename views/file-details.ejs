<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a href="/dashboard" class="navbar-brand"><i class="fas fa-cloud"></i> File Uploader</a>
            <div>
                <span class="text-light me-3">Hello, <%= user.name %>!</span>
                <a href="/auth/logout" class="btn btn-outline-light btn-sm">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
                <% if (file.folder) { %>
                    <li class="breadcrumb-item"><a href="/folders/<%= file.folder.id %>"><%= file.folder.name %></a></li>
                <% } %>
                <li class="breadcrumb-item active"><%= file.originalName %></li>
            </ol>
        </nav>

        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-file"></i> File Details</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <!-- File Icon -->
                                <% 
                                let iconClass = 'fa-file';
                                if (file.mimetype.startsWith('image/')) iconClass = 'fa-file-image';
                                else if (file.mimetype.startsWith('video/')) iconClass = 'fa-file-video';
                                else if (file.mimetype.startsWith('audio/')) iconClass = 'fa-file-audio';
                                else if (file.mimetype === 'application/pdf') iconClass = 'fa-file-pdf';
                                else if (file.mimetype.includes('word')) iconClass = 'fa-file-word';
                                else if (file.mimetype.includes('excel') || file.mimetype.includes('spreadsheet')) iconClass = 'fa-file-excel';
                                else if (file.mimetype.includes('powerpoint') || file.mimetype.includes('presentation')) iconClass = 'fa-file-powerpoint';
                                else if (file.mimetype.includes('zip') || file.mimetype.includes('rar')) iconClass = 'fa-file-archive';
                                %>
                                <i class="fas <%= iconClass %> fa-5x text-secondary mb-3"></i>
                            </div>
                            <div class="col-md-9">
                                <table class="table table-bordered">
                                    <tr>
                                        <th width="30%">File Name</th>
                                        <td><%= file.originalName %></td>
                                    </tr>
                                    <tr>
                                        <th>File Type</th>
                                        <td><%= file.mimetype %></td>
                                    </tr>
                                    <tr>
                                        <th>File Size</th>
                                        <td>
                                            <% 
                                            let size = file.size;
                                            let units = ['B', 'KB', 'MB', 'GB'];
                                            let i = 0;
                                            while (size >= 1024 && i < units.length - 1) {
                                                size /= 1024;
                                                i++;
                                            }
                                            %>
                                            <%= size.toFixed(i > 0 ? 1 : 0) %> <%= units[i] %>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Upload Date</th>
                                        <td><%= new Date(file.createdAt).toLocaleString() %></td>
                                    </tr>
                                    <tr>
                                        <th>Last Modified</th>
                                        <td><%= new Date(file.updatedAt).toLocaleString() %></td>
                                    </tr>
                                    <tr>
                                        <th>Location</th>
                                        <td>
                                            <% if (file.folder) { %>
                                                <i class="fas fa-folder text-warning"></i> <%= file.folder.name %>
                                            <% } else { %>
                                                <i class="fas fa-home"></i> Root Directory
                                            <% } %>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/files/<%= file.id %>/download" class="btn btn-success">
                                <i class="fas fa-download"></i> Download File
                            </a>
                            
                            <button class="btn btn-secondary" onclick="copyToClipboard()">
                                <i class="fas fa-copy"></i> Copy File Info
                            </button>
                            
                            <form method="POST" action="/files/<%= file.id %>?_method=DELETE" 
                                  onsubmit="return confirm('Are you sure you want to delete this file? This action cannot be undone.')">
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="fas fa-trash"></i> Delete File
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- File Preview (for images) -->
                <% if (file.mimetype.startsWith('image/')) { %>
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>Preview</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="/uploads/<%= file.filename %>" alt="<%= file.originalName %>" 
                             class="img-fluid rounded" style="max-height: 300px;">
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function copyToClipboard() {
            const fileInfo = `File: <%= file.originalName %>
Size: <%= (file.size / 1024).toFixed(1) %> KB
Type: <%= file.mimetype %>
Uploaded: <%= new Date(file.createdAt).toLocaleString() %>`;
            
            navigator.clipboard.writeText(fileInfo).then(() => {
                alert('File information copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</body>
</html>